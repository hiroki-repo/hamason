!function t(e,n,o){function r(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return r(n?n:t)},l,l.exports,t,e,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(t,e,n){function o(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function i(t){return"number"==typeof t}function s(t){return"object"==typeof t&&null!==t}function a(t){return void 0===t}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.prototype.setMaxListeners=function(t){if(!i(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},o.prototype.emit=function(t){var e,n,o,i,c,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[t],a(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),n.apply(this,i)}else if(s(n))for(i=Array.prototype.slice.call(arguments,1),l=n.slice(),o=l.length,c=0;o>c;c++)l[c].apply(this,i);return!0},o.prototype.addListener=function(t,e){var n;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(n=a(this._maxListeners)?o.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},o.prototype.on=o.prototype.addListener,o.prototype.once=function(t,e){function n(){this.removeListener(t,n),o||(o=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var o=!1;return n.listener=e,this.on(t,n),this},o.prototype.removeListener=function(t,e){var n,o,i,a;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],i=n.length,o=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(n)){for(a=i;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){o=a;break}if(0>o)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},o.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},o.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},o.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},o.listenerCount=function(t,e){return t.listenerCount(e)}},{}],2:[function(t,e,n){var o,r,i,s=[].slice;i=t("./utils/ReadyHelper.coffee"),r=t("./utils/Cookie.coffee"),o=function(){function t(t,e){this.context=t,this.debug=e.get("debug"),this.logger=smartlook.logger.child("app"),this.readyHelper=new i(this.context.win,this.context.doc),this.plugins={}}return t.prototype.debug=!1,t.prototype.initialized=!1,t.prototype.transport=null,t.prototype.recordingPolicy=null,t.prototype.dataManager=null,t.prototype.eventManager=null,t.prototype.readyHelper=null,t.prototype.recording=!1,t.prototype.closed=!1,t.prototype.context=null,t.prototype.disabled=!1,t.prototype.startDelay=1e3,t.prototype.writeIntervalId=null,t.prototype.hasWriteRequest=!1,t.prototype.plugin=function(t,e){this.plugins[t]=e},t.prototype.setRecordingPolicy=function(t){this.recordingPolicy=t},t.prototype.setDataManager=function(t){this.dataManager=t},t.prototype.setConnection=function(t){this.connection=t,this.connection.on("connect",function(t){return function(){if(!t.closed){if(t.isDisabled())return void t.connection.init(!0);t.start(),t.connection.init()}}}(this)),this.connection.on("disconnected",function(t){return function(){t.close(!1,!0)}}(this)),this.connection.on("record.restart",function(t){return function(){t.restart()}}(this)),this.connection.on("record.init",function(t){return function(e){var n;return e.rid?(t.recordId&&t.recordId!==e.rid&&(t.debug&&t.logger.log("record.init changed; rid:"+e.rid+"; rid_old:"+t.recordId),t.stop(!1)),t.debug&&t.logger.log("record.init; rid:"+e.rid),t.start(),t.writeResume(!0),void(t.recordId=e.rid)):(t.debug&&t.logger.log("record.init; rid:null"),t.close(!1,e.disabled),void(e.disabled||(n=new Date,n.setUTCHours(n.getUTCHours()+3),r.set("smartlook_disabled","disabled",n))))}}(this))},t.prototype.setEventManager=function(t){this.eventManager=t,this.eventManager.on("action",function(t){return function(e){return t.onAction(e)}}(this))},t.prototype.init=function(){this.initialized||r.get("smartlook_disabled")||(this.debug&&this.logger.log("initialize"),this.initialized=!0,this.readyHelper.ready(function(t){return function(){return setTimeout(function(){return t.start()},t.startDelay)}}(this)),this.readyHelper.unload(function(t){return function(){return t.close(!0)}}(this)),this.connection.connect())},t.prototype.start=function(){this.recording||this.closed||(this.debug&&this.logger.log("recording start"),this.recording=!0,this.dataManager.start())},t.prototype.stop=function(t){null==t&&(t=!1),this.recording&&!this.closed&&(this.debug&&this.logger.log("recording stop; write="+t),this.recording=!1,this.dataManager.stop(),t&&this.write(),this.dataManager.clear())},t.prototype.restart=function(){this.closed||(this.debug&&this.logger.log("recording restart"),this.writePause(),this.stop(!1),this.start(),this.connection.options.rid=this.recordId=null,this.connection.init())},t.prototype.close=function(t,e){null==t&&(t=!1),null==e&&(e=!1),this.closed||(this.debug&&this.logger.log("recording close; write="+t+"; silent="+e),this.writePause(),this.stop(t),this.closed=!0,e||this.connection.close(),e||this.connection.disconnect())},t.prototype.writeResume=function(t){null==t&&(t=!1),null===this.writeIntervalId&&(this.debug&&this.logger.log("write resume; write:"+t),t&&setTimeout(function(t){return function(){return t.write()}}(this),500),clearInterval(this.writeIntervalId),this.writeIntervalId=setInterval(function(t){return function(){return t.write()}}(this),1e4))},t.prototype.writePause=function(){null!==this.writeIntervalId&&(this.debug&&this.logger.log("write pause"),clearInterval(this.writeIntervalId),this.writeIntervalId=null)},t.prototype.write=function(){var t,e;return this.connection.writing?(this.hasWriteRequest=!0,void(this.debug&&this.logger.log("write skipped, connection is writing..."))):(e=this.dataManager.fetch(),void(e&&(t="",e.data.length>0&&(t+=JSON.stringify(e.data)+"\n"),e.events.length>0&&(t+=JSON.stringify(e.events)+"\n"),this.connection.write(e.time,t,function(t){return function(e,n){return e?(t.debug&&t.logger.log("write error:",e),void t.stop()):(t.debug&&t.logger.log("write response:",n),n&&!n.success?void t.restart():void(t.hasWriteRequest&&(t.debug&&t.logger.log("write requested, going write again"),t.hasWriteRequest=!1,t.write())))}}(this)),this.debug&&this.logger.log("write execute; length:"+t.length))))},t.prototype.setDisabled=function(t){this.disabled=t},t.prototype.isDisabled=function(){switch(typeof this.disabled){case"boolean":if(this.disabled)return!0;break;case"function":if(this.disabled())return!0}return!1},t.prototype.onAction=function(t){if(t)switch(typeof t){case"function":t();break;case"object":switch(t.name){case"tag":t.options&&this.execute("tag",t.options.name,t.options.value)}}},t.prototype.installApi=function(t){var e,n,o,r;for(r=t.api,e=0,n=r.length;n>e;e++)o=r[e],this.execute.apply(this,o);t.api=t._={push:function(t){return function(e){return t.execute.apply(t,e)}}(this)}},t.prototype.execute=function(){var t,e;return e=arguments[0],t=2<=arguments.length?s.call(arguments,1):[],this.plugins[e]?void this.plugins[e].apply(this.plugins[e],t):void console.error("Unsupported smartlook API call "+e)},t}(),e.exports=o},{"./utils/Cookie.coffee":24,"./utils/ReadyHelper.coffee":28}],3:[function(t,e,n){var o,r,i,s,a,c,l,u,p;o=t("./Application.coffee"),s=t("./recording/DataManager.coffee"),u=t("./recording/RecordingPolicy.coffee"),l=t("./recording/HtmlCollector.coffee"),a=t("./recording/EventCollector.coffee"),p=t("./server/VtConnectionFactory.coffee"),c=t("./services/EventManager.coffee"),i=t("./utils/Cookie.coffee"),r=function(){function e(){}return e.prototype.create=function(e){var n,r,u,d,f,h,g;return d=e.getContext(),i.document=d.doc,i.domain=e.get("cookieDomain")||d.doc.domain,i.path=e.get("cookiePath")||"/",n=new o(d,e),n.logger=smartlook.logger.child("app"),u=new p(e),r=u.create(),n.setConnection(r),g=this.createRecordingPolicy({debug:e.get("debug",!1)}),n.setRecordingPolicy(g),f=new s(d),f.setHtmlCollector(new l(g)),f.setEventCollector(new a(g)),n.setDataManager(f),h=new c(d),n.setEventManager(h),n.plugin("tag",t("./plugins/tag")(n)),n.plugin("tags",t("./plugins/tags")(n)),n.plugin("ignore",t("./plugins/ignore")(n)),n.plugin("filter",t("./plugins/filter")(n)),n.plugin("disable",t("./plugins/disable")(n)),n.plugin("event",t("./plugins/event")(n)),n},e.prototype.createRecordingPolicy=function(t){var e;return e=new u(t),e.addFilter('[data-smartlook-ignore="html"]',{html:!0,htmlTitle:"HTML blocked"}),e.addFilter('[data-smartlook-ignore="events"]',{events:!0}),e.addFilter('[data-smartlook-ignore="mask"]',{mask:!0}),e.addFilter('[data-visitortrace-ignore="html"]',{html:!0,htmlTitle:"HTML blocked"}),e.addFilter('[data-visitortrace-ignore="events"]',{events:!0}),e.addFilter('[data-visitortrace-ignore="mask"]',{mask:!0}),e.addFilter('[data-recording-ignore="html"]',{html:!0,htmlTitle:"HTML blocked"}),e.addFilter('[data-recording-ignore="events"]',{events:!0}),e.addFilter('[data-recording-ignore="mask"]',{mask:!0}),e.addFilter("a",{attr:["href"]}),e.addFilter("script",{html:!0,attr:!0}),e.addFilter("iframe",{html:!0,htmlTitle:"IFrame blocked",attr:["src"],replace:"div",size:!0}),e.addFilter('[type="password"]',{mask:!0}),e.addFilter("#tracy-debug",{html:!0,attr:!0}),e.addFilter("#fb-root",{html:!0,attr:!0}),e.addFilter("style",{html:!0,attr:!0,validate:function(t){return t.innerHTML.indexOf(".fb_hidden{")>=0}}),e},e}(),e.exports=r},{"./Application.coffee":2,"./plugins/disable":6,"./plugins/event":7,"./plugins/filter":8,"./plugins/ignore":9,"./plugins/tag":10,"./plugins/tags":11,"./recording/DataManager.coffee":12,"./recording/EventCollector.coffee":14,"./recording/HtmlCollector.coffee":15,"./recording/RecordingPolicy.coffee":17,"./server/VtConnectionFactory.coffee":22,"./services/EventManager.coffee":23,"./utils/Cookie.coffee":24}],4:[function(t,e,n){var o,r;r=t("./utils/Object.coffee"),o=function(){function t(t){var e,n;null==t&&(t={});for(e in t)n=t[e],this[e]=n}return t.prototype.window=null,t.prototype.document=null,t.prototype.debug=!1,t.prototype.host="s2.getsmartlook.com",t.prototype.key=null,t.prototype.sid=null,t.prototype.vid=null,t.prototype.cookieDomain=null,t.prototype.cookiePath=null,t.prototype.cookieEnabled=null,t.prototype.setContext=function(t,e){null==t&&(t=null),null==e&&(e=null),this.window=t,this.document=e},t.prototype.getContext=function(){return{win:this.window,doc:this.document}},t.prototype.set=function(t,e){null==e&&(e=null),"object"==typeof t?(t.window&&(this.window=t.window,delete t.window),t.document&&(this.document=t.document,delete t.document),r.merge(this,t)):r.set(this,t,e)},t.prototype.get=function(t,e){return r.get(this,t,e)},t}(),e.exports=o},{"./utils/Object.coffee":27}],5:[function(t,e,n){var o,r,i,s,a,c,l,u,p,d;for(i=t("../vendor/lockr"),s=t("./utils/Logger"),a=t("./utils/Support"),r=t("./Config"),o=t("./ApplicationFactory"),i.prefix="visitortrace.",d=window.smartlook||window.visitortrace,d.version="1.2.4",d.logger=new s,d.config=new r,d.isSupported=a.isSupported(window,document),window.smartlook=d,window.visitortrace=d,d.init=function(t,e){var n,r;null==e&&(e=null),t&&(d.initialized||d.isSupported&&(d.config.setContext(window,document),d.config.set("key",t),e&&d.config.set(e),n=i.get("config"),n&&d.config.set(n),r=new o,d.app=r.create(d.config),d.app.installApi(d),d.app.init(),d.initialized=!0))},d.api=d.api||d._,p=d.api,c=0,l=p.length;l>c;c++)if(u=p[c],"init"===u[0]){d.api.splice(d.api.indexOf(u),1),d.init(u[1],u[2]);break}window.parent.smartlook=d,window.parent.visitortrace=d},{"../vendor/lockr":30,"./ApplicationFactory":3,"./Config":4,"./utils/Logger":26,"./utils/Support":29}],6:[function(t,e,n){e.exports=function(t){return function(e){void 0===e&&(e=!0),t.setDisabled(e)}}},{}],7:[function(t,e,n){e.exports=function(t){return function(e,n,o){t.eventManager.add({target:e,event:n,action:o})}}},{}],8:[function(t,e,n){e.exports=function(t){return function(e,n){t.recordingPolicy.addFilter(e,{html:!0,htmlTitle:n,size:!0})}}},{}],9:[function(t,e,n){e.exports=function(t){return function(e,n){null==n&&(n={}),"html"===n?n={html:!0}:"events"===n?n={events:!0}:"mask"===n&&(n={mask:!0}),t.recordingPolicy.addFilter(e,n)}}},{}],10:[function(t,e,n){e.exports=function(t){return function(e,n){t.closed||t.connection.tag(e,n)}}},{}],11:[function(t,e,n){e.exports=function(t){return function(e){t.closed||t.connection.tags(e)}}},{}],12:[function(t,e,n){var o,r,i,s,a=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("events"),r=t("./DataStorage.coffee"),s=t("./Timer.coffee"),o=function(t){function e(t){this.context=t,this.timer=new s,this.storage=new r,this.context.html=this.context.doc.getElementsByTagName("html")[0],this.context.head=this.context.doc.getElementsByTagName("head")[0],this.context.body=this.context.doc.getElementsByTagName("body")[0]}return a(e,t),e.prototype.context=null,e.prototype.timer=null,e.prototype.storage=null,e.prototype.htmlCollector=null,e.prototype.eventCollector=null,e.prototype.setEventCollector=function(t){this.eventCollector=t,this.eventCollector.setTimer(this.timer),this.eventCollector.setContext(this.context)},e.prototype.setHtmlCollector=function(t){this.htmlCollector=t,this.htmlCollector.setTimer(this.timer),this.htmlCollector.setContext(this.context),this.htmlCollector.on("added",function(t){return function(e,n){return t.eventCollector.bindElement(n)}}(this)),this.htmlCollector.on("removed",function(t){return function(e,n){return t.eventCollector.unbindElement(n)}}(this)),this.htmlCollector.on("clear",function(t){return function(){return t.storeHtml()}}(this))},e.prototype.start=function(){this.timer.start(),this.storage.clear(),this.eventCollector.start(),this.storeEvetsInterval=setInterval(function(t){return function(){return t.storeEvents()}}(this),100),this.htmlCollector.start(),this.storeHtmlInterval=setInterval(function(t){return function(){return t.storeHtml()}}(this),500)},e.prototype.stop=function(){this.timer.stop(),this.eventCollector.stop(),clearInterval(this.storeEvetsInterval),this.storeEvents(),this.htmlCollector.stop(),clearInterval(this.storeHtmlInterval),this.storeHtml()},e.prototype.fetch=function(){var t,e,n;return t=this.storage.getData(),e=this.storage.getEvents(),0===t.length&&0===e.length?null:(n={time:this.timer.getTime(),data:this.storage.getData(),events:this.storage.getEvents()},this.storage.clear(),n)},e.prototype.clear=function(){this.storage.clear()},e.prototype.storeEvents=function(){var t,e,n,o;for(o=this.eventCollector.getChanges(),t=0,n=o.length;n>t;t++)e=o[t],this.storage.addEvent(e);this.eventCollector.resetChanges()},e.prototype.storeHtml=function(){var t,e,n,o;for(o=this.htmlCollector.getChanges(),t=0,n=o.length;n>t;t++)e=o[t],this.storage.addData(e);this.htmlCollector.resetChanges()},e}(i),e.exports=o},{"./DataStorage.coffee":13,"./Timer.coffee":18,events:1}],13:[function(t,e,n){var o;o=function(){function t(){this.rows=[],this.events=[]}return t.prototype.rows=null,t.prototype.events=null,t.prototype.addData=function(t){this.rows.push(t)},t.prototype.addEvent=function(t){this.events.push(t)},t.prototype.getData=function(){return this.rows},t.prototype.getEvents=function(){return this.events},t.prototype.clear=function(){this.rows=[],this.events=[]},t}(),e.exports=o},{}],14:[function(t,e,n){var o,r,i;o=t("../utils/DomHelper.coffee"),i=t("../../vendor/lockr"),r=function(){function t(t){this.policy=t,this.listeners={},this.events=[],this.managedInputs=[],this.managedScrollElements=[],this.helper=new o}return t.prototype.context=null,t.prototype.timer=null,t.prototype.helper=null,t.prototype.events=null,t.prototype.policy=null,t.prototype.listeners=null,t.prototype.managedInputs=null,t.prototype.managedScrollElements=null,t.prototype.lastMouseClientX=null,t.prototype.lastMouseClientY=null,t.prototype.enabled=!1,t.prototype.setTimer=function(t){this.timer=t},t.prototype.setContext=function(t){this.context=t,this.context.win.addEventListener("resize",this.getListener("onWindowResize")),this.context.win.addEventListener("scroll",this.getListener("onWindowScroll")),this.context.win.addEventListener("mousemove",this.getListener("onMouseMove")),this.context.win.addEventListener("click",this.getListener("onClick")),this.context.win.addEventListener("blur",this.getListener("onBlur"),!0),this.context.win.addEventListener("focus",this.getListener("onFocus"),!0),this.bindElement(this.context.doc)},t.prototype.getChanges=function(){return this.events},t.prototype.resetChanges=function(){this.events.splice(0,this.events.length)},t.prototype.start=function(){this.enabled=!0,this.resetChanges(),this.loadState(),this.checkChangeIntervalId=setInterval(function(t){return function(){return t.checkInputChange()}}(this),100)},t.prototype.stop=function(){this.enabled=!1,this.addEvent("stop"),this.persistState(),clearInterval(this.checkChangeIntervalId)},t.prototype.bindElement=function(t){var e,n,o,r,i,s,a,c,l;if(((s=t.nodeType)===Node.ELEMENT_NODE||s===Node.DOCUMENT_NODE)&&(l=this.policy.getFilterRoot(t),!l||!l._vtFilter.events&&!l._vtFilter.html)){for(this.helper.matches(t,"input,textarea,select")&&(t._vtScope=t._vtFilter?t:l,this.managedInputs.push(t)),this.helper.matches(t,"div")&&(this.managedScrollElements.push(t),t.addEventListener("scroll",this.getListener("onElementScroll"),!0)),a=t.querySelectorAll("input,textarea,select"),e=0,o=a.length;o>e;e++)i=a[e],l=this.policy.getFilterRoot(i),l&&(l._vtFilter.events||l._vtFilter.html)||(i._vtScope=i._vtFilter?i:l,this.managedInputs.push(i));for(c=t.querySelectorAll("div"),n=0,r=c.length;r>n;n++)i=c[n],i._vtFilter&&(i._vtFilter.events||i._vtFilter.html)||(this.managedScrollElements.push(i),i.addEventListener("scroll",this.getListener("onElementScroll"),!0))}},t.prototype.unbindElement=function(t){var e,n,o,r,i,s,a,c;if(t.nodeType===Node.ELEMENT_NODE||t.nodeType===Node.DOCUMENT_NODE){for(t._vtScope=null,a=t.querySelectorAll("input,textarea,select"),e=0,r=a.length;r>e;e++)s=a[e],s._vtScope=null,n=this.managedInputs.indexOf(s),n>=0&&this.managedInputs.splice(n,1);for(c=t.querySelectorAll("div"),o=0,i=c.length;i>o;o++)s=c[o],n=this.managedScrollElements.indexOf(s),n>=0&&this.managedScrollElements.splice(n,1)}},t.prototype.checkInputChange=function(){var t,e,n,o,r;for(o=this.managedInputs,t=0,e=o.length;e>t;t++)n=o[t],r=this.helper.getValue(n),n._vtScope&&n._vtScope._vtFilter&&n._vtScope._vtFilter.mask&&(r="*".repeat(r.length)),n.__value!==r&&(n.__value=r,this.addEvent("change",{target:this.helper.getPath(n),value:r}))},t.prototype.persistState=function(){i.set("recording.lmcx",this.lastMouseClientX),i.set("recording.lmcy",this.lastMouseClientY)},t.prototype.loadState=function(){this.lastMouseClientX=i.get("recording.lmcx")||null,this.lastMouseClientY=i.get("recording.lmcy")||null,null!==this.lastMouseClientX&&(this.lastMouseClientX=parseInt(this.lastMouseClientX),this.lastMouseClientY=parseInt(this.lastMouseClientY),this.setEvent("mousemove",{x:this.lastMouseClientX,y:this.lastMouseClientY}))},t.prototype.getListener=function(t){return this.listeners[t]||(this.listeners[t]=this.createListener(t)),this.listeners[t]},t.prototype.createListener=function(t){return function(e){return function(n){return e.enabled?e[t](n):void 0}}(this)},t.prototype.setEvent=function(t,e){var n,o,r;if(n=this.getEvent(t)){n.time=this.timer.getTime();for(o in e)r=e[o],n.options[o]=r}else this.addEvent(t,e)},t.prototype.addEvent=function(t,e){this.events.push({name:t,time:this.timer.getTime(),options:e})},t.prototype.getEvent=function(t){var e,n,o,r;for(r=this.events,n=0,o=r.length;o>n;n++)if(e=r[n],e.name===t)return e;return null},t.prototype.onElementScroll=function(t){this.setEvent("scrollel",{target:this.helper.getPath(t.target),top:t.target.scrollTop,left:t.target.scrollLeft})},t.prototype.onWindowResize=function(t){this.setEvent("resize",{width:this.context.win.innerWidth,height:this.context.win.innerHeight})},t.prototype.onWindowScroll=function(t){this.setEvent("scroll",{top:this.context.win.pageYOffset||this.context.doc.documentElement.scrollTop,left:this.context.win.pageXOffset||this.context.doc.documentElement.scrollLeft})},t.prototype.onClick=function(t){this.addEvent("click",{target:this.helper.getPath(t.target),clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY,pageX:t.pageX,pageY:t.pageY,screenX:t.screenX,screenY:t.screenY,button:t.button})},t.prototype.onMouseMove=function(t){this.lastMouseClientX=t.clientX,this.lastMouseClientY=t.clientY,this.setEvent("mousemove",{x:t.clientX,y:t.clientY})},t.prototype.onBlur=function(t){this.addEvent("blur",{})},t.prototype.onFocus=function(t){this.addEvent("focus",{target:this.helper.getPath(t.target)})},t}(),e.exports=r},{"../../vendor/lockr":30,"../utils/DomHelper.coffee":25}],15:[function(t,e,n){var o,r,i,s,a,c=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;r=t("events"),a=window.MutationObserver||window.WebKitMutationObserver,o=t("../utils/DomHelper.coffee"),s=t("./HtmlFilter"),i=function(t){function e(t){this.policy=t,this.observer=new a(function(t){return function(e){return t.onMutations(e)}}(this)),this.helper=new o,this.filter=new s}return c(e,t),e.prototype.changes=null,e.prototype.observer=null,e.prototype.timer=null,e.prototype.helper=null,e.prototype.policy=null,e.prototype.filter=null,e.prototype.addedList=null,e.prototype.removedList=null,e.prototype.setTimer=function(t){this.timer=t},e.prototype.setContext=function(t){this.context=t,this.decorateElement(this.context.doc)},e.prototype.getChanges=function(){var t,e,n,o,r;for(e=[],r=this.changes,n=0,o=r.length;o>n;n++)t=r[n],("m"!==t.type||t.added||t.removed||t.attr||t.html)&&e.push(t);return e},e.prototype.resetChanges=function(){this.changes=[]},e.prototype.start=function(){this.resetChanges(),this.init(),this.observer.observe(this.context.doc,{childList:!0,subtree:!0,attributes:!0,characterData:!0})},e.prototype.stop=function(){this.observer.disconnect()},e.prototype.init=function(){var t,e,n,o,r,i,s,a;this.decorateElement(this.context.doc),r=this.context.doc,s=this.context.html,i=this.context.head,e=this.context.body,t=r.querySelector("head base"),t||(t=r.createElement("base"),t.setAttribute("href",this.context.doc.location.toString()),i.insertBefore(t,i.firstChild)),r.getElementById("smartlook-style")||(a=r.createElement("link"),a.setAttribute("id","smartlook-style"),a.setAttribute("rel","stylesheet"),a.setAttribute("media","screen"),i.appendChild(a)),r.getElementById("smartlook-ct")||(o=r.createElement("div"),o.setAttribute("id","smartlook-ct"),e.appendChild(o)),n=this.requireChange("init","init"),n.version=smartlook.version,n.html=this.formatHtml(this.filterElement(s).outerHTML),this.context.doc.doctype&&(n.doctype=this.context.doc.doctype.name)},e.prototype.onMutations=function(t){var e,n,o,r,i;for(this.addedList=[],this.removedList=[],e=0,o=t.length;o>e;e++)i=t[e],"childList"===i.type&&this.onMutation(i);for(n=0,r=t.length;r>n;n++)i=t[n],"childList"!==i.type&&this.onMutation(i)},e.prototype.onMutation=function(t){var e,n,o,r,i,s,a,c;if(this.helper.hasParent(t.target,this.context.doc)&&(c="characterData"===t.type?t.target.parentNode:t.target,c.parentNode)){if(t.removedNodes.length>0)for(o=[],a=t.removedNodes,n=0,r=a.length;r>n;n++)i=a[n],o.push(i);else o=null;if(s=this.helper.getPath(c,o)){switch(e=this.requireChange(s,"m"),t.type){case"attributes":this.onMutationAttributes(t,e,s);break;case"characterData":this.onMutationCharacterData(t,e,s);break;case"childList":this.onMutationChildList(t,e,s)}("characterData"===t.type||"childList"===t.type)&&(this.emit("clear"),this.resetChanges())}}},e.prototype.onMutationCharacterData=function(t,e,n){this.policy.getFilterRoot(t.target,{html:!0})||(e.html=t.target.parentNode.innerHTML)},e.prototype.onMutationAttributes=function(t,e,n){var o;"data-smartlook-filter"!==(o=t.attributeName)&&"data-smartlook-priority"!==o&&(this.policy.getFilterRoot(t.target,{html:!0})||t.target._vtFilter&&t.target._vtFilter.attr||(e.attr||(e.attr={}),e.attr[t.attributeName]=t.target.getAttribute(t.attributeName)))},e.prototype.onMutationChildList=function(t,e,n){this.policy.getFilterRoot(t.target,{html:!0})||(t.removedNodes.length>0&&this.onMutationRemoved(t,e,n),t.addedNodes.length>0&&this.onMutationAdded(t,e,n))},e.prototype.onMutationAdded=function(t,e,n){var o,r,i,s,a,c,l,u,p;for(u=t.addedNodes,i=0,a=u.length;a>i;i++)if(l=u[i],l.parentNode&&!(this.addedList.indexOf(l)>0)&&(l.nodeType===Node.ELEMENT_NODE&&(this.decorateElement(l),e.added||(e.added=[]),r=this.filterElement(l),e.added.push({at:this.helper.getIndexOf(t.target,l),el:this.helper.getName(r),attr:this.helper.getAttributes(r),html:this.formatHtml(r.innerHTML)}),this.emit("added",e,l)),l.nodeType===Node.ELEMENT_NODE&&this.addedList.indexOf(l)<0))for(this.addedList.push(l),p=this.helper.getAllChilds(l),s=0,c=p.length;c>s;s++)o=p[s],this.addedList.push(o)},e.prototype.onMutationRemoved=function(t,e,n){var o,r,i,s,a,c,l,u,p,d,f,h,g;for(g=[],d=t.removedNodes,r=0,c=d.length;c>r;r++)p=d[r],g.push(p);for(f=t.removedNodes,s=0,l=f.length;l>s;s++)if(p=f[s],!(this.addedList.indexOf(t.target)>=0)&&!(this.removedList.indexOf(p)>0)&&(i=t.previousSibling?t.previousSibling.nodeType===Node.ELEMENT_NODE?this.helper.getIndexOf(t.target,t.previousSibling,g)+1:this.helper.getIndexOf(t.target,t.previousSibling.previousElementSibling,g)+1:t.nextSibling?t.nextSibling.nodeType===Node.ELEMENT_NODE?this.helper.getIndexOf(t.target,t.nextSibling,g)-1:this.helper.getIndexOf(t.target,t.nextSibling.nextElementSibling,g)-1:0,e.html||null===p._vtManaged||void 0===p._vtManaged||(e.removed||(e.removed=[]),e.removed.push({at:i}),this.markElement(t.target),this.emit("removed",e,p)),p.nodeType===Node.ELEMENT_NODE&&this.removedList.indexOf(p)<0))for(this.removedList.push(p),h=this.helper.getAllChilds(p),a=0,u=h.length;u>a;a++)o=h[a],this.removedList.push(o)},e.prototype.decorateElement=function(t){return this.markElement(t),this.policy.decorate(t),t},e.prototype.markElement=function(t){var e,n,o,r;for(t._vtManaged=!0,r=t.childNodes,e=0,n=r.length;n>e;e++)o=r[e],o.nodeType===Node.ELEMENT_NODE&&this.markElement(o)},e.prototype.filterElement=function(t){return this.filter.filter(t,this.policy.filters)},e.prototype.formatHtml=function(t){return t?(t=t.replace(/rel="nofollow"/g,""),t=t.replace(/alt="[^"]+"/g,""),t=t.replace(/data-toggle="[^"]+"/g,""),t=t.replace(/data-smartlook-filtered="[^"]+"/g,""),t=t.replace(/title="[^"]+"/g,""),t=t.replace(/\s+/g," "),t=t.replace(/\>\n\t+\</g,"> <"),t=t.replace(/__src=/g,"src=")):""},e.prototype.requireChange=function(t,e){var n,o,r,i,s;for(n=null,s=this.changes,o=0,i=s.length;i>o;o++)if(r=s[o],r.path===t){n=r;break}return n||(n={path:t,time:this.timer.getTime(),type:e},this.changes.push(n)),n},e}(r),e.exports=i},{"../utils/DomHelper.coffee":25,"./HtmlFilter":16,events:1}],16:[function(t,e,n){var o,r;o=t("../utils/DomHelper.coffee"),r=function(){function t(){this.helper=new o}return t.prototype.filter=function(t){var e;return this.hasFilteredElements(t)?(e=this.cloneNode(t),this.filterElements(e,t),e):t},t.prototype.hasFilteredElements=function(t){var e,n,o,r;if(t._vtFilter&&(t._vtFilter.html||t._vtFilter.attr||t._vtFilter.replace))return!0;for(r=t.childNodes,e=0,n=r.length;n>e;e++)if(o=r[e],o.nodeType===Node.ELEMENT_NODE&&this.hasFilteredElements(o))return!0;return!1},t.prototype.filterElements=function(t,e){var n,o,r,i;if(t._vtFilter&&(t._vtFilter.html||t._vtFilter.attr||t._vtFilter.replace)&&this.filterElement(t,e))return t;if(t.childNodes)for(i=t.childNodes,n=0,o=i.length;o>n;n++)r=i[n],this.filterElements(r,e);return!1},t.prototype.filterElement=function(t,e){var n,o,r,i,s,a,c,l,u,p,d,f,h,g,v,y,m,_,b,w,x;if(f=t._vtFilter,r=!1,f.replace){for(w=e.ownerDocument.createElement(f.replace),m=t.attributes,o=0,c=m.length;c>o;o++)n=m[o],w.setAttribute(n.name,n.value);t.parentNode.replaceChild(w,t),t=w}if(f.html&&(r=!0,f.htmlBody?t.innerHTML=f.htmlBody:f.htmlTitle?t.innerHTML=this.createHtmlFilteredContent(f.htmlTitle):t.innerHTML=""),f.attr){if(x=[],f.attr===!0)for(_=t.attributes,i=0,l=_.length;l>i;i++)n=_[i],x.push(n.name);else for(b=f.attr,s=0,u=b.length;u>s;s++)d=b[s],x.push(d);for(a=0,p=x.length;p>a;a++)d=x[a],t.removeAttribute(d)}return f.html&&f.size&&(g=this.helper.getPath(t),v=this.helper.getPath(e),y=g.replace(new RegExp("^"+v+","),""),(h=this.helper.getNodeByPath(y,e))&&(t.style.width=h.offsetWidth+"px",t.style.height=h.offsetHeight+"px")),r},t.prototype.cloneNode=function(t){var e,n,o,r,i,s,a,c,l,u,p;if(t.hasAttribute&&t.hasAttribute("src"))for(n=t.ownerDocument.createElement(t.nodeName),n.innerHTML=t.innerHTML,u=t.attributes,r=0,s=u.length;s>r;r++){e=u[r];try{c="src"===e.name?"__src":e.name,n.setAttribute(c,e.value)}catch(d){o=d}}else n=t.cloneNode();if(t._vtFilter&&(n._vtFilter=t._vtFilter),t._vtPriority&&(n._vtPriority=t._vtPriority),t.childNodes&&(!t._vtFilter||!t._vtFilter.html))for(p=t.childNodes,i=0,a=p.length;a>i;i++)l=p[i],n.appendChild(this.cloneNode(l));return n},t.prototype.createHtmlFilteredContent=function(t){return'<div class="smartlook-block">\n	<div class="smartlook-inner">\n		<div class="smartlook-title">'+t+'</div>\n		<div class="smartlook-desc">This block is ignored from data streaming.</div>\n	</div>\n</div>'},t}(),e.exports=r},{"../utils/DomHelper.coffee":25}],17:[function(t,e,n){var o,r;o=t("../utils/DomHelper.coffee"),r=function(){function t(t){null==t&&(t={}),t.hasOwnProperty("debug")&&(this.debug=t.debug),this.filters=[],this.helper=new o}return t.prototype.filters=null,t.prototype.helper=null,t.prototype.debug=!1,t.prototype.addFilter=function(t,e){var n;return null==e&&(e={}),n={},n.query=t,n.options=e,e.html?n.priority=4:e.events?n.priority=3:e.mask?n.priority=2:n.priority=1,e.validate&&(n.validate=e.validate,delete e.validate),this.filters.push(n),
n},t.prototype.getFilterRoot=function(t,e){var n;for(null==e&&(e={}),n=null;t;)!t._vtPriority||n&&!(t._vtPriority>=n._vtPriority)||e&&!this.matching(t,e)||(n=t),t=t.parentNode;return n},t.prototype.decorate=function(t){var e,n,o,r,i,s,a,c,l,u,p,d;if(t.nodeType===Node.ELEMENT_NODE)for(l=this.filters,o=0,s=l.length;s>o;o++)n=l[o],this.helper.matches(t,n.query)&&(n.validate&&n.validate(t)||(!t._vtPriority||n.priority>t._vtPriority)&&(t._vtFilter=n.options,this.debug&&t.setAttribute("data-smartlook-filter",JSON.stringify(t._vtFilter)),t._vtPriority=n.priority,this.debug&&t.setAttribute("data-smartlook-priority",t._vtPriority)));if((u=t.nodeType)===Node.ELEMENT_NODE||u===Node.DOCUMENT_NODE)for(p=this.filters,r=0,a=p.length;a>r;r++)for(n=p[r],d=t.querySelectorAll(n.query),i=0,c=d.length;c>i;i++)e=d[i],e.nodeType===Node.ELEMENT_NODE&&(!n.validate||n.validate(e))&&(!e._vtPriority||n.priority>e._vtPriority)&&(e._vtFilter=n.options,this.debug&&e.setAttribute("data-smartlook-filter",JSON.stringify(e._vtFilter)),e._vtPriority=n.priority,this.debug&&e.setAttribute("data-smartlook-priority",e._vtPriority));this.debug&&t.setAttribute&&t.setAttribute("data-smartlook-policy",!0)},t.prototype.matching=function(t,e){var n,o;for(n in e)if(o=e[n],t._vtFilter[n]!==o)return!1;return!0},t}(),e.exports=r},{"../utils/DomHelper.coffee":25}],18:[function(t,e,n){var o;o=function(){function t(){}return t.prototype.timestamp=0,t.prototype.intervalId=null,t.prototype.start=function(){this.timestamp=0,this.intervalId=setInterval(function(t){return function(){return t.timestamp++}}(this),10)},t.prototype.stop=function(){clearInterval(this.intervalId)},t.prototype.getTime=function(){return this.timestamp},t}(),e.exports=o},{}],19:[function(t,e,n){var o,r;r=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],o=function(){function t(t){var e;this.host=t,e=top.document.location.protocol,"file:"===e&&(e="http:"),this.host=e+"//"+this.host,this.logger=smartlook.logger.child("http")}return t.prototype.debug=!1,t.prototype.post=function(t){var e;e=this.createXMLHTTPObject(),e&&(e.open("POST",this.host+t.url,!0),e.setRequestHeader("Content-type","text/plain"),e.withCredentials=!0,e.onreadystatechange=function(){var n;if(4===e.readyState){if(e.responseText)try{n=JSON.parse(e.responseText)}catch(o){n=null}else n=null;if(200!==e.status&&304!==e.status){if(t.onFailure)return t.onFailure(n)}else if(t.onSuccess)return t.onSuccess(n)}},4!==e.readyState&&(e.send(t.data),this.debug&&this.logger.log("send request "+t.url)))},t.prototype.createXMLHTTPObject=function(){var t,e,n,o,i;for(i=null,n=0,o=r.length;o>n;n++){e=r[n];try{i=e()}catch(s){t=s;continue}break}return i},t}(),e.exports=o},{}],20:[function(t,e,n){var o,r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=t("events"),r=t("../../vendor/sockjs.js"),i=function(t){function e(t){this.host=t,this.logger=smartlook.logger.child("sockjs")}return s(e,t),e.prototype.debug=!1,e.prototype.socket=null,e.prototype.host=null,e.prototype.connected=!1,e.prototype.connecting=!1,e.prototype.reconnecting=!1,e.prototype.reconnectAttempts=0,e.prototype.maxReconnectAttempts=5,e.prototype.reconnectDelay=500,e.prototype.maxReconnectDelay=16e3,e.prototype.reconnectTimeout=3e4,e.prototype.heartbeatTimeout=6e4,e.prototype.heartbeatId=null,e.prototype.wasDisconnected=!1,e.prototype.preventReconnect=!1,e.prototype.connect=function(){var t;this.connected||(this.connecting=!0,this.connected=!1,t=top.document.location.protocol,"file:"===t&&(t="http:"),this.socket=new r(t+"//"+this.host+"/socket"),this.socket.onopen=function(t){return function(){t.onConnect()}}(this),this.socket.onmessage=function(t){return function(e){t.updateHeartbeatTimeout(),t.onMessage(e)}}(this),this.socket.onclose=function(t){return function(e){t.onDisconnect(e)}}(this),this.socket.onheartbeat=function(t){return function(e){t.updateHeartbeatTimeout(),t.socket.send("")}}(this),window.top.smartlookSocket=this.socket)},e.prototype.disconnect=function(t){null==t&&(t="booted"),this.socket&&this.socket.close(null,t)},e.prototype.reconnect=function(t){this.disconnect("reconnect"),setTimeout(function(e){return function(){return e.debug&&e.logger.log("RECONNECT after "+t+"ms"),e.connect()}}(this),t)},e.prototype.send=function(t,e){null==e&&(e=null),e?(this.debug&&this.logger.log("SEND: "+t,e),this.sendRaw(JSON.stringify({name:t,data:e}))):(this.debug&&this.logger.log("SEND: "+t),this.sendRaw(JSON.stringify({name:t})))},e.prototype.sendRaw=function(t){this.updateHeartbeatTimeout(),this.socket.send(t)},e.prototype.updateHeartbeatTimeout=function(){this.heartbeatId&&clearTimeout(this.heartbeatId),this.heartbeatId=setTimeout(function(t){return function(){return t.onHeartbeatTimeouted()}}(this),this.heartbeatTimeout)},e.prototype.onHeartbeatTimeouted=function(){this.socket&&(this.debug&&this.logger.log("TIMEOUT: Heartbeat missed"),this.socket.close(null,"reconnect"))},e.prototype.onConnect=function(){this.connecting=!1,this.connected=!0,this.reconnectAttempts=0,this.reconnectDelay=500,this.reconnecting=!1,this.wasDisconnected=!1,this.debug&&this.logger.log("CONNECTED "+this.host),this.emit("connect")},e.prototype.onDisconnect=function(t){var e;return this.connecting=!1,this.connected=!1,this.socket=null,this.debug&&this.logger.log("DISCONNECTING",t),this.emit("disconnect"),this.preventReconnect||"booted"===t.reason?void this.onDisconnected():(setTimeout(function(t){return function(){t.connected||t.wasDisconnected||t.onDisconnected()}}(this),this.reconnectTimeout),void(this.maxReconnectAttempts>this.reconnectAttempts&&(e=this.reconnectDelay,this.reconnectAttempts++,this.reconnectDelay=Math.min(this.maxReconnectDelay,2*this.reconnectDelay),this.reconnecting=!0,this.reconnect(e))))},e.prototype.onDisconnected=function(){this.wasDisconnected=!0,this.debug&&this.logger.log("DISCONNECTED"),this.emit("disconnected")},e.prototype.onMessage=function(t){var e,n;if(t.data){try{n=JSON.parse(t.data)}catch(o){return e=o,void(this.debug&&this.logger.log("ERROR:",e))}this.debug&&this.logger.log("MESSAGE: "+n.name,n.data),this.emit(n.name,n.data)}},e}(o),e.exports=i},{"../../vendor/sockjs.js":31,events:1}],21:[function(t,e,n){var o,r,i,s,a,c=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;o=t("events"),i=t("../utils/Object.coffee"),s=t("../server/SockJSConnection.coffee"),r=t("../server/HttpConnection.coffee"),a=function(t){function e(t){null==t&&(t={}),this.options={debug:!1,key:null,vid:null,sid:null,rid:null,data:{},tags:{}},i.merge(this.options,t),this.tagsToSave={},this.http=new r(this.options.host),this.http.debug=this.options.debug,this.sockjs=new s(this.options.host),this.sockjs.debug=this.options.debug,this.sockjs.on("connect",function(t){return function(){return t.onConnect()}}(this)),this.sockjs.on("disconnect",function(t){return function(){return t.onDisconnect()}}(this)),this.sockjs.on("disconnected",function(t){return function(){return t.onDisconnected()}}(this)),this.sockjs.on("record.init",function(t){return function(e){return t.onRecordInit(e)}}(this)),this.sockjs.on("record.restart",function(t){return function(e){return t.onRecordRestart(e)}}(this))}return c(e,t),e.prototype.sockjs=null,e.prototype.http=null,e.prototype.options=null,e.prototype.initialized=!1,e.prototype.writing=!1,e.prototype.connect=function(){this.sockjs.connect()},e.prototype.disconnect=function(){this.sockjs.disconnect()},e.prototype.reconnect=function(t){null==t&&(t=1e3),this.sockjs.reconnect(t)},e.prototype.init=function(t){null==t&&(t=!1),this.sockjs.send("record.init",{key:this.options.key,vid:this.options.vid,sid:this.options.sid,rid:this.options.rid,data:this.options.data,tags:this.tagsToSave,disabled:t}),this.tagsToSave={}},e.prototype.update=function(t){i.merge(this.options.data,t),this.options.rid&&this.initialized&&this.sockjs.send("record.update",t)},e.prototype.write=function(t,e,n){var o;if(null==n&&(n=null),this.options.rid){if(this.writing)return n(Error("Connection already writing"));o={url:"/app/write?rid="+this.options.rid+"&time="+t,data:e,onSuccess:function(t){return function(e){return t.writing=!1,n(null,e)}}(this),onFailure:function(t){return function(){return t.writing=!1,n(null,null)}}(this)},this.writing=!0,this.http.post(o)}},e.prototype.close=function(){this.options.rid&&this.initialized&&(this.sockjs.send("record.close"),this.sockjs.preventReconnect=!0)},e.prototype.tag=function(t,e){this.options.tags[t]!==e&&(this.tagsToSave[t]=e,this.options.tags[t]=e,this.saveTags())},e.prototype.tags=function(t){var e,n,o;e=!1;for(n in t)o=t[n],this.options.tags[n]!==o&&(this.options.tags[n]=o,this.tagsToSave[n]=o,e=!0);e&&this.saveTags()},e.prototype.saveTags=function(){return 0!==Object.keys(this.tagsToSave).length&&this.options.rid&&this.initialized?setTimeout(function(t){return function(){var e;0!==Object.keys(t.tagsToSave).length&&(e=t.tagsToSave,t.tagsToSave={},t.sockjs.send("session.tags",{tags:e}),e=null)}}(this),100):void 0},e.prototype.onConnect=function(){this.emit("connect")},e.prototype.onDisconnect=function(){this.initialized=!1,this.emit("disconnect")},e.prototype.onDisconnected=function(){this.initialized=!1,this.emit("disconnected")},e.prototype.onRecordInit=function(t){this.initialized=!0,this.options.rid=t.rid,this.options.sid=t.sid,this.options.vid=t.vid,this.emit("record.init",t),this.saveTags()},e.prototype.onRecordRestart=function(){this.initialized=!1,this.options.rid=null,this.emit("record.restart")},e}(o),e.exports=a},{"../server/HttpConnection.coffee":19,"../server/SockJSConnection.coffee":20,"../utils/Object.coffee":27,events:1}],22:[function(t,e,n){var o,r,i,s;i=t("../../vendor/lockr"),o=t("./VtConnection.coffee"),r=t("../utils/Cookie.coffee"),s=function(){function t(t){this.config={},null===t.get("cookieEnabled")?this.cookieEnabled=null!==(t.get("cookieDomain",null)||t.get("cookiePath",null)):this.cookieEnabled=t.get("cookieEnabled"),this.config.debug=t.get("debug"),this.config.host=t.get("host"),this.config.key=t.get("key"),this.config.sid=t.get("sid")||i.get("config.sid")||r.get("vt.sid")||null,this.config.vid=t.get("vid")||i.get("config.vid")||r.get("vt.vid")||null,this.config.data=this.getData(t.getContext())}return t.prototype.config=null,t.prototype.create=function(){var t;return t=new o(this.config),t.on("record.init",function(t){return function(e){return t.onRecordInit(e)}}(this)),t},t.prototype.onRecordInit=function(t){t.sid&&(this.config.sid=t.sid,this.cookieEnabled&&r.set("vt.sid",t.sid,1/0),i.set("config.sid",t.sid)),t.vid&&(this.config.vid=t.vid,this.cookieEnabled&&r.set("vt.vid",t.vid,1/0),i.set("config.vid",t.vid))},t.prototype.getData=function(t){var e,n,o,r,i,s;return s=t.win,e=t.doc,o=s.navigator,r=Math.abs(s.orientation)-90===0?"landscape":"portrait",i=r===s.screen.availHeight,n=r===s.screen.availWidth,s.innerWidth&&(i=s.innerWidth),s.innerHeight&&(n=s.innerHeight),{userAgent:o.userAgent,platform:o.platform,pageTitle:e.title,pageUrl:e.location.toString(),domain:e.location.host,referer:e.referrer,orientation:r,screenWidth:i||s.screen.width,screenHeight:n||s.screen.height}},t}(),e.exports=s},{"../../vendor/lockr":30,"../utils/Cookie.coffee":24,"./VtConnection.coffee":21}],23:[function(t,e,n){var o,r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=t("events"),i=function(t){function e(t){this.context=t,this.events=[],this.context.win.addEventListener("click",this.createListener("click")),this.context.win.addEventListener("blur",this.createListener("blur"),!0),this.context.win.addEventListener("focus",this.createListener("focus"),!0),this.context.win.addEventListener("keyup",this.createListener("keyup"),!0),this.context.win.addEventListener("keydown",this.createListener("keydown"),!0),this.context.win.addEventListener("keypress",this.createListener("keypress"),!0)}return s(e,t),e.prototype.context=null,e.prototype.events=null,e.prototype.load=function(t){var e,n,o;for(n=0,o=t.length;o>n;n++)e=t[n],this.add(e)},e.prototype.add=function(t){return t=this.createEvent(t),this.events.push(t),t},e.prototype.createEvent=function(t){return new o(this,t)},e.prototype.createListener=function(t){return function(e){return function(n){return e.onEvent(t,n)}}(this)},e.prototype.onEvent=function(t,e){var n,o,r;for(r=this.events,n=0,o=r.length;o>n;n++)e=r[n],e.match(t,e)&&this.emit("action",e.action)},e}(r),o=function(){function t(t,e){this.manager=t,this.target=e.target,this.event=e.event,this.action=e.action}return t.prototype.target=null,t.prototype.event=null,t.prototype.action=null,t.prototype.match=function(t,e){var n;return t!==this.event?!1:e.target?(n=this.manager.context.doc.querySelectorAll(this.target))&&Array.prototype.indexOf.call(n,e.target)<0?!1:!0:!1},t}(),e.exports=i},{events:1}],24:[function(t,e,n){var o;o=function(){function t(){}return t.domain=null,t.path=null,t.document=document,t.get=function(t,e){return null==e&&(e=null),t?decodeURIComponent(this.document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||e:e},t.set=function(t,e,n,o,r,i){var s,a;if(o||(o=this.path),r||(r=this.domain),!t||/^(?:expires|max\-age|path|domain|secure)$/i.test(t))return!1;if(a="",n)switch(n.constructor){case Number:a=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:a="; expires="+n;break;case Date:a="; expires="+n.toUTCString()}return s=encodeURIComponent(t)+"="+encodeURIComponent(e)+a+(r?"; domain="+r:"")+(o?"; path="+o:"")+(i?"; secure":""),this.document.cookie=s,!0},t.remove=function(t,e,n){return this.hasItem(t)?(this.document.cookie=encodeURIComponent(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(n?"; domain="+n:"")+(e?"; path="+e:""),!0):!1},t.has=function(t){return t?new RegExp("(?:^|;\\s*)"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(this.document.cookie):!1},t.keys=function(){var t,e,n,o,r;for(t=this.document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),n=e=0,r=t.length;r>e;n=++e)o=t[n],t[n]=decodeURIComponent(o);return t},t}(),e.exports=o},{}],25:[function(t,e,n){var o;o=function(){function t(){}return t.prototype.hasParent=function(t,e){for(;t!==e&&t.parentNode;)t=t.parentNode;return t===e},t.prototype.getPath=function(t,e){var n,o,r,i;for(null==e&&(e=null),r=[],n=t;n;){for(o=0,i=n;i=i.previousSibling;)i.nodeType===Node.ELEMENT_NODE&&(!e||e.indexOf(i)<0)&&o++;n.nodeType===Node.ELEMENT_NODE&&"HTML"!==n.nodeName&&r.unshift(o),n=n.parentNode}return r.join(",")},t.prototype.getNodeByPath=function(t,e){var n,o,r,i;for(i=t.split(","),n=0,o=i.length;o>n;n++){if(r=i[n],!e)return null;if(!e.childNodes)return null;e=this.getChildren(e,parseInt(r))}return e},t.prototype.getChildren=function(t,e){var n,o,r,i;for(null==e&&(e=0),i=t.childNodes,n=0,o=i.length;o>n;n++)if(r=i[n],r.nodeType===Node.ELEMENT_NODE&&e--,0>e)return r;return null},t.prototype.getIndexOf=function(t,e,n){var o,r,i,s,a;for(null==n&&(n=null),r=0,a=t.childNodes,o=0,i=a.length;i>o;o++){if(s=a[o],s===e)return r;s.nodeType===Node.ELEMENT_NODE&&(!n||n.indexOf(s)<0)&&r++}return-1},t.prototype.reindexDom=function(t){var e,n,o,r,i;for(n=0,i=t.childNodes,e=0,o=i.length;o>e;e++)r=i[e],r.nodeType===Node.ELEMENT_NODE&&(r.__domindex=n++),this.reindexDom(r)},t.prototype.getAttributes=function(t){var e,n,o,r,i;for(e={},i=t.attributes,o=0,r=i.length;r>o;o++)n=i[o],e[n.name]=n.value;return e},t.prototype.getName=function(t){return t.nodeName.toLowerCase()},t.prototype.getValue=function(t){var e;switch(t.getAttribute("type")){case"password":e=t.value.replace(/./g,"*");break;case"radio":e=t.checked;break;default:e=t.value}return e},t.prototype.getAllChilds=function(t,e){var n,o,r,i;if(null==e&&(e=[]),t.childNodes)for(i=t.childNodes,n=0,o=i.length;o>n;n++)r=i[n],r.nodeType===Node.ELEMENT_NODE&&(e.push(r),this.getAllChilds(r,e));return e},t.prototype.matches=function(t,e){return t.matches?t.matches(e):t.webkitMatchesSelector?t.webkitMatchesSelector(e):t.mozMatchesSelector?t.mozMatchesSelector(e):t.msMatchesSelector?t.msMatchesSelector(e):!1},t}(),e.exports=o},{}],26:[function(t,e,n){var o,r=[].slice;o=function(){function t(t){this.options=null!=t?t:{},this.options.title=this.options.title||"Visitortrace",this.options.bg=this.options.bg||"#4d4d4d",this.options.color=this.options.color||"#ffffff"}return t.prototype.options=null,t.prototype.log=function(){var t,e;t=1<=arguments.length?r.call(arguments,0):[];try{console.log.apply(console,["%c "+this.options.title+" ","background: "+this.options.bg+"; color: "+this.options.color].concat(t))}catch(n){e=n,console.error(e)}},t.prototype.child=function(e){return new t({title:this.options.title+":"+e,bg:this.options.bg,color:this.options.color})},t}(),e.exports=o},{}],27:[function(t,e,n){e.exports={merge:function(t,e){var n,o;for(n in e)o=e[n],"object"==typeof o?this.merge(t[n],o):t[n]=o;return t},get:function(t,e,n){var o,r;return null==n&&(n=void 0),e.indexOf(".")>0?(o=e.substring(0,e.indexOf(".")),r=e.substring(e.indexOf(".")+1),t[o]?this.get(t[o],r,n):n):t[e]||n},set:function(t,e,n){var o,r;e.indexOf(".")>0?(o=e.substring(0,e.indexOf(".")),r=e.substring(e.indexOf(".")+1),t[o]||(t[o]={}),this.set(t[o],r,n)):t[e]=n}}},{}],28:[function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)s.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;o=t("events"),r=function(t){function e(t,e){this.win=t,this.doc=e,this.doc.getElementsByTagName("body")[0]?this.load():this.win.addEventListener("DOMContentLoaded",function(t){return function(){return t.load()}}(this))}return i(e,t),e.prototype.body=!1,e.prototype.win=null,e.prototype.doc=null,e.prototype.load=function(){this.body||(this.body=this.doc.getElementsByTagName("body")[0],this.emit("load"))},e.prototype.ready=function(t){this.body?t():this.on("load",function(e){return function(){return t()}}(this))},e.prototype.unload=function(t){this.win.addEventListener("beforeunload",function(e){return function(){return t()}}(this))},e}(o),e.exports=r},{events:1}],29:[function(t,e,n){e.exports={isSupported:function(t,e){var n;return n=e.createElement("div"),(t.MutationObserver||t.WebKitMutationObserver)&&(n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector)?!0:!1}}},{}],30:[function(t,e,n){!function(t,o){"undefined"!=typeof n?"undefined"!=typeof e&&e.exports&&(n=e.exports=o(t,n)):"function"==typeof define&&define.amd?define(["exports"],function(e){t.Lockr=o(t,e)}):t.Lockr=o(t,{})}(this,function(t,e){"use strict";return Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length>>>0,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=e);e>n;n++)if(n in this&&this[n]===t)return n;return-1}),e.prefix="",e._getPrefixedKey=function(t,e){return e=e||{},e.noPrefix?t:this.prefix+t},e.set=function(t,e,n){var o=this._getPrefixedKey(t,n);try{localStorage.setItem(o,JSON.stringify({data:e}))}catch(r){console&&console.warn("Lockr didn't successfully save the '{"+t+": "+e+"}' pair, because the localStorage is full.")}},e.get=function(t,e,n){var o,r=this._getPrefixedKey(t,n);try{o=JSON.parse(localStorage.getItem(r))}catch(i){o=localStorage[r]?JSON.parse('{"data":"'+localStorage.getItem(r)+'"}'):null}return null===o?e:"object"==typeof o&&"undefined"!=typeof o.data?o.data:o||e},e.sadd=function(t,n,o){var r,i=this._getPrefixedKey(t,o),s=e.smembers(t);if(s.indexOf(n)>-1)return null;try{s.push(n),r=JSON.stringify({data:s}),localStorage.setItem(i,r)}catch(a){console.log(a),console&&console.warn("Lockr didn't successfully add the "+n+" to "+t+" set, because the localStorage is full.")}},e.smembers=function(t,e){var n,o=this._getPrefixedKey(t,e);try{n=JSON.parse(localStorage.getItem(o))}catch(r){n=null}return null===n?[]:n.data||[]},e.sismember=function(t,n,o){this._getPrefixedKey(t,o);return e.smembers(t).indexOf(n)>-1},e.getAll=function(){var t=Object.keys(localStorage);return t.map(function(t){return e.get(t)})},e.srem=function(t,n,o){var r,i,s=this._getPrefixedKey(t,o),a=e.smembers(t,n);i=a.indexOf(n),i>-1&&a.splice(i,1),r=JSON.stringify({data:a});try{localStorage.setItem(s,r)}catch(c){console&&console.warn("Lockr couldn't remove the "+n+" from the set "+t)}},e.rm=function(t){localStorage.removeItem(t)},e.flush=function(){localStorage.clear()},e})},{}],31:[function(require,module,exports){var JSON;JSON||(JSON={}),function(){function str(t,e){var n,o,r,i,s,a=gap,c=e[t];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(t)),"function"==typeof rep&&(c=rep.call(e,t,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(i=c.length,n=0;i>n;n+=1)s[n]=str(n,c)||"null";return r=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(i=rep.length,n=0;i>n;n+=1)"string"==typeof rep[n]&&(o=rep[n],r=str(o,c),r&&s.push(quote(o)+(gap?": ":":")+r));else for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(r=str(o,c),r&&s.push(quote(o)+(gap?": ":":")+r));return r=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,r}}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function f(t){return 10>t?"0"+t:t}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(t){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(t){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,n){var o;if(gap="",indent="","number"==typeof n)for(o=0;n>o;o+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=e,!e||"function"==typeof e||"object"==typeof e&&"number"==typeof e.length)return str("",{"":t});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var n,o,r=t[e];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(o=walk(r,n),void 0!==o?r[n]=o:delete r[n]);return reviver.call(t,e,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var t=document,e=window,n={},o=function(){};o.prototype.addEventListener=function(t,e){this._listeners||(this._listeners={}),t in this._listeners||(this._listeners[t]=[]);var o=this._listeners[t];-1===n.arrIndexOf(o,e)&&o.push(e)},o.prototype.removeEventListener=function(t,e){if(this._listeners&&t in this._listeners){var o=this._listeners[t],r=n.arrIndexOf(o,e);return-1!==r?void(o.length>1?this._listeners[t]=o.slice(0,r).concat(o.slice(r+1)):delete this._listeners[t]):void 0}},o.prototype.dispatchEvent=function(t){var e=t.type,n=Array.prototype.slice.call(arguments,0);if(this["on"+e]&&this["on"+e].apply(this,n),this._listeners&&e in this._listeners)for(var o=0;o<this._listeners[e].length;o++)this._listeners[e][o].apply(this,n)};var r=function(t,e){if(this.type=t,"undefined"!=typeof e)for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n])};r.prototype.toString=function(){var t=[];for(var e in this)if(this.hasOwnProperty(e)){var n=this[e];"function"==typeof n&&(n="[function]"),t.push(e+"="+n)}return"SimpleEvent("+t.join(", ")+")"};var i=function(t){var e=this;e._events=t||[],e._listeners={}};i.prototype.emit=function(t){var e=this;if(e._verifyType(t),!e._nuked){var n=Array.prototype.slice.call(arguments,1);if(e["on"+t]&&e["on"+t].apply(e,n),t in e._listeners)for(var o=0;o<e._listeners[t].length;o++)e._listeners[t][o].apply(e,n)}},i.prototype.on=function(t,e){var n=this;n._verifyType(t),n._nuked||(t in n._listeners||(n._listeners[t]=[]),n._listeners[t].push(e))},i.prototype._verifyType=function(t){var e=this;-1===n.arrIndexOf(e._events,t)&&n.log("Event "+JSON.stringify(t)+" not listed "+JSON.stringify(e._events)+" in "+e)},i.prototype.nuke=function(){var t=this;t._nuked=!0;for(var e=0;e<t._events.length;e++)delete t[t._events[e]];t._listeners={}};var s="abcdefghijklmnopqrstuvwxyz0123456789_";n.random_string=function(t,e){e=e||s.length;var n,o=[];for(n=0;t>n;n++)o.push(s.substr(Math.floor(Math.random()*e),1));return o.join("")},n.random_number=function(t){return Math.floor(Math.random()*t)},n.random_number_string=function(t){var e=(""+(t-1)).length,o=Array(e+1).join("0");return(o+n.random_number(t)).slice(-e)},n.getOrigin=function(t){t+="/";var e=t.split("/").slice(0,3);return e.join("/")},n.isSameOriginUrl=function(t,n){return n||(n=e.location.href),t.split("/").slice(0,3).join("/")===n.split("/").slice(0,3).join("/")},n.getParentDomain=function(t){if(/^[0-9.]*$/.test(t))return t;if(/^\[/.test(t))return t;if(!/[.]/.test(t))return t;var e=t.split(".").slice(1);return e.join(".")},n.objectExtend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t};var a="_jp";n.polluteGlobalNamespace=function(){a in e||(e[a]={})},n.closeFrame=function(t,e){return"c"+JSON.stringify([t,e])},n.userSetCode=function(t){return 1e3===t||t>=3e3&&4999>=t},n.countRTO=function(t){var e;return e=t>100?3*t:t+200},n.log=function(){e.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},n.bind=function(t,e){return t.bind?t.bind(e):function(){return t.apply(e,arguments)}},n.flatUrl=function(t){return-1===t.indexOf("?")&&-1===t.indexOf("#")},n.amendUrl=function(e){var o=t.location;if(!e)throw new Error("Wrong url for SockJS");if(!n.flatUrl(e))throw new Error("Only basic urls are supported in SockJS");return 0===e.indexOf("//")&&(e=o.protocol+e),0===e.indexOf("/")&&(e=o.protocol+"//"+o.host+e),e=e.replace(/[\/]+$/,"")},n.arrIndexOf=function(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1},n.arrSkip=function(t,e){var o=n.arrIndexOf(t,e);if(-1===o)return t.slice();var r=t.slice(0,o);return r.concat(t.slice(o+1))},n.isArray=Array.isArray||function(t){return{}.toString.call(t).indexOf("Array")>=0},n.delay=function(t,e){return"function"==typeof t&&(e=t,t=0),setTimeout(e,t)};var c,l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,u={"\x00":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","	":"\\t","\n":"\\n","\x0B":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","":"\\u00ad","":"\\u0600","":"\\u0601","":"\\u0602","":"\\u0603","":"\\u0604","":"\\u070f","":"\\u17b4","":"\\u17b5","":"\\u200c","":"\\u200d","":"\\u200e","":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","":"\\u202a","":"\\u202b","":"\\u202c","":"\\u202d","":"\\u202e","":"\\u202f","":"\\u2060","":"\\u2061","":"\\u2062","":"\\u2063","":"\\u2064","":"\\u2065","":"\\u2066","":"\\u2067","":"\\u2068","":"\\u2069","":"\\u206a","":"\\u206b","":"\\u206c","":"\\u206d","":"\\u206e","":"\\u206f","\ufeff":"\\ufeff","":"\\ufff0","":"\\ufff1","":"\\ufff2","":"\\ufff3","":"\\ufff4","":"\\ufff5","":"\\ufff6","":"\\ufff7","":"\\ufff8","":"\\ufff9","":"\\ufffa","":"\\ufffb","":"\\ufffc","":"\\ufffd","":"\\ufffe","":"\\uffff"},p=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,d=JSON&&JSON.stringify||function(t){return l.lastIndex=0,l.test(t)&&(t=t.replace(l,function(t){return u[t]})),'"'+t+'"'},f=function(t){var e,n={},o=[];for(e=0;65536>e;e++)o.push(String.fromCharCode(e));return t.lastIndex=0,o.join("").replace(t,function(t){return n[t]="\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4),""}),t.lastIndex=0,n};n.quote=function(t){var e=d(t);return p.lastIndex=0,p.test(e)?(c||(c=f(p)),e.replace(p,function(t){return c[t]})):e};var h=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];n.probeProtocols=function(){for(var t={},e=0;e<h.length;e++){var n=h[e];t[n]=k[n]&&k[n].enabled()}return t},n.detectProtocols=function(t,e,n){var o={},r=[];e||(e=h);for(var i=0;i<e.length;i++){var s=e[i];o[s]=t[s]}var a=function(t){var e=t.shift();o[e]?r.push(e):t.length>0&&a(t)};return n.websocket!==!1&&a(["websocket"]),o["xhr-streaming"]&&!n.null_origin?r.push("xhr-streaming"):!o["xdr-streaming"]||n.cookie_needed||n.null_origin?a(["iframe-eventsource","iframe-htmlfile"]):r.push("xdr-streaming"),o["xhr-polling"]&&!n.null_origin?r.push("xhr-polling"):!o["xdr-polling"]||n.cookie_needed||n.null_origin?a(["iframe-xhr-polling","jsonp-polling"]):r.push("xdr-polling"),r};var g="_sockjs_global";n.createHook=function(){var t="a"+n.random_string(8);if(!(g in e)){var o={};e[g]=function(t){return t in o||(o[t]={id:t,del:function(){delete o[t]}}),o[t]}}return e[g](t)},n.attachMessage=function(t){
n.attachEvent("message",t)},n.attachEvent=function(n,o){"undefined"!=typeof e.addEventListener?e.addEventListener(n,o,!1):(t.attachEvent("on"+n,o),e.attachEvent("on"+n,o))},n.detachMessage=function(t){n.detachEvent("message",t)},n.detachEvent=function(n,o){"undefined"!=typeof e.addEventListener?e.removeEventListener(n,o,!1):(t.detachEvent("on"+n,o),e.detachEvent("on"+n,o))};var v={},y=!1,m=function(){for(var t in v)v[t](),delete v[t]},_=function(){y||(y=!0,m())};n.attachEvent("unload",_),n.unload_add=function(t){var e=n.random_string(8);return v[e]=t,y&&n.delay(m),e},n.unload_del=function(t){t in v&&delete v[t]},n.createIframe=function(e,o){var r,i,s=t.createElement("iframe"),a=function(){clearTimeout(r);try{s.onload=null}catch(t){}s.onerror=null},c=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),n.unload_del(i))},l=function(t){s&&(c(),o(t))},u=function(t,e){try{s&&s.contentWindow&&s.contentWindow.postMessage(t,e)}catch(n){}};return s.src=e,s.style.display="none",s.style.position="absolute",s.onerror=function(){l("onerror")},s.onload=function(){clearTimeout(r),r=setTimeout(function(){l("onload timeout")},2e3)},t.body.appendChild(s),r=setTimeout(function(){l("timeout")},15e3),i=n.unload_add(c),{post:u,cleanup:c,loaded:a}},n.createHtmlfile=function(t,o){var r,i,s,c=new ActiveXObject("htmlfile"),l=function(){clearTimeout(r)},u=function(){c&&(l(),n.unload_del(i),s.parentNode.removeChild(s),s=c=null,CollectGarbage())},p=function(t){c&&(u(),o(t))},d=function(t,e){try{s&&s.contentWindow&&s.contentWindow.postMessage(t,e)}catch(n){}};c.open(),c.write('<html><script>document.domain="'+document.domain+'";</script></html>'),c.close(),c.parentWindow[a]=e[a];var f=c.createElement("div");return c.body.appendChild(f),s=c.createElement("iframe"),f.appendChild(s),s.src=t,r=setTimeout(function(){p("timeout")},15e3),i=n.unload_add(u),{post:d,cleanup:u,loaded:l}};var b=function(){};b.prototype=new i(["chunk","finish"]),b.prototype._start=function(t,o,r,i){var s=this;try{s.xhr=new XMLHttpRequest}catch(a){}if(!s.xhr)try{s.xhr=new e.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}(e.ActiveXObject||e.XDomainRequest)&&(o+=(-1===o.indexOf("?")?"?":"&")+"t="+ +new Date),s.unload_ref=n.unload_add(function(){s._cleanup(!0)});try{s.xhr.open(t,o,!0)}catch(c){return s.emit("finish",0,""),void s._cleanup()}if(i&&i.no_credentials||(s.xhr.withCredentials="true"),i&&i.headers)for(var l in i.headers)s.xhr.setRequestHeader(l,i.headers[l]);s.xhr.onreadystatechange=function(){if(s.xhr){var t=s.xhr;switch(t.readyState){case 3:try{var e=t.status,n=t.responseText}catch(t){}1223===e&&(e=204),n&&n.length>0&&s.emit("chunk",e,n);break;case 4:var e=t.status;1223===e&&(e=204),s.emit("finish",e,t.responseText),s._cleanup(!1)}}},s.xhr.send(r)},b.prototype._cleanup=function(t){var e=this;if(e.xhr){if(n.unload_del(e.unload_ref),e.xhr.onreadystatechange=function(){},t)try{e.xhr.abort()}catch(o){}e.unload_ref=e.xhr=null}},b.prototype.close=function(){var t=this;t.nuke(),t._cleanup(!0)};var w=n.XHRCorsObject=function(){var t=this,e=arguments;n.delay(function(){t._start.apply(t,e)})};w.prototype=new b;var x=n.XHRLocalObject=function(t,e,o){var r=this;n.delay(function(){r._start(t,e,o,{no_credentials:!1})})};x.prototype=new b;var E=n.XDRObject=function(t,e,o){var r=this;n.delay(function(){r._start(t,e,o)})};E.prototype=new i(["chunk","finish"]),E.prototype._start=function(t,e,o){var r=this,i=new XDomainRequest;e+=(-1===e.indexOf("?")?"?":"&")+"t="+ +new Date;var s=i.ontimeout=i.onerror=function(){r.emit("finish",0,""),r._cleanup(!1)};i.onprogress=function(){r.emit("chunk",200,i.responseText)},i.onload=function(){r.emit("finish",200,i.responseText),r._cleanup(!1)},r.xdr=i,r.unload_ref=n.unload_add(function(){r._cleanup(!0)});try{r.xdr.open(t,e),r.xdr.send(o)}catch(a){s()}},E.prototype._cleanup=function(t){var e=this;if(e.xdr){if(n.unload_del(e.unload_ref),e.xdr.ontimeout=e.xdr.onerror=e.xdr.onprogress=e.xdr.onload=null,t)try{e.xdr.abort()}catch(o){}e.unload_ref=e.xdr=null}},E.prototype.close=function(){var t=this;t.nuke(),t._cleanup(!0)},n.isXHRCorsCapable=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:e.XDomainRequest&&t.domain?2:H.enabled()?3:4};var k=function(t,o,r){if(this===e)return new k(t,o,r);var i,s=this;s._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},r&&n.objectExtend(s._options,r),s._base_url=n.amendUrl(t),s._server=s._options.server||n.random_number_string(1e3),s._options.protocols_whitelist&&s._options.protocols_whitelist.length?i=s._options.protocols_whitelist:(i="string"==typeof o&&o.length>0?[o]:n.isArray(o)?o:null,i&&s._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),s._protocols=[],s.protocol=null,s.readyState=k.CONNECTING,s._ir=W(s._base_url),s._ir.onfinish=function(t,e){s._ir=null,t?(s._options.info&&(t=n.objectExtend(t,s._options.info)),s._options.rtt&&(e=s._options.rtt),s._applyInfo(t,e,i),s._didClose()):s._didClose(1002,"Can't connect to server",!0)}};k.prototype=new o,k.version="0.3.4",k.CONNECTING=0,k.OPEN=1,k.CLOSING=2,k.CLOSED=3,k.prototype._debug=function(){this._options.debug&&n.log.apply(n,arguments)},k.prototype._dispatchOpen=function(){var t=this;t.readyState===k.CONNECTING?(t._transport_tref&&(clearTimeout(t._transport_tref),t._transport_tref=null),t.readyState=k.OPEN,t.dispatchEvent(new r("open"))):t._didClose(1006,"Server lost session")},k.prototype._dispatchMessage=function(t){var e=this;e.readyState===k.OPEN&&e.dispatchEvent(new r("message",{data:t}))},k.prototype._dispatchHeartbeat=function(t){var e=this;e.readyState===k.OPEN&&e.dispatchEvent(new r("heartbeat",{}))},k.prototype._didClose=function(t,e,o){var i=this;if(i.readyState!==k.CONNECTING&&i.readyState!==k.OPEN&&i.readyState!==k.CLOSING)throw new Error("INVALID_STATE_ERR");i._ir&&(i._ir.nuke(),i._ir=null),i._transport&&(i._transport.doCleanup(),i._transport=null);var s=new r("close",{code:t,reason:e,wasClean:n.userSetCode(t)});if(!n.userSetCode(t)&&i.readyState===k.CONNECTING&&!o){if(i._try_next_protocol(s))return;s=new r("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:s})}i.readyState=k.CLOSED,n.delay(function(){i.dispatchEvent(s)})},k.prototype._didMessage=function(t){var e=this,n=t.slice(0,1);switch(n){case"o":e._dispatchOpen();break;case"a":for(var o=JSON.parse(t.slice(1)||"[]"),r=0;r<o.length;r++)e._dispatchMessage(o[r]);break;case"m":var o=JSON.parse(t.slice(1)||"null");e._dispatchMessage(o);break;case"c":var o=JSON.parse(t.slice(1)||"[]");e._didClose(o[0],o[1]);break;case"h":e._dispatchHeartbeat()}},k.prototype._try_next_protocol=function(e){var o=this;for(o.protocol&&(o._debug("Closed transport:",o.protocol,""+e),o.protocol=null),o._transport_tref&&(clearTimeout(o._transport_tref),o._transport_tref=null);;){var r=o.protocol=o._protocols.shift();if(!r)return!1;if(k[r]&&k[r].need_body===!0&&(!t.body||"undefined"!=typeof t.readyState&&"complete"!==t.readyState))return o._protocols.unshift(r),o.protocol="waiting-for-load",n.attachEvent("load",function(){o._try_next_protocol()}),!0;if(k[r]&&k[r].enabled(o._options)){var i=k[r].roundTrips||1,s=(o._options.rto||0)*i||5e3;o._transport_tref=n.delay(s,function(){o.readyState===k.CONNECTING&&o._didClose(2007,"Transport timeouted")});var a=n.random_string(8),c=o._base_url+"/"+o._server+"/"+a;return o._debug("Opening transport:",r," url:"+c," RTO:"+o._options.rto),o._transport=new k[r](o,c,o._base_url),!0}o._debug("Skipping transport:",r)}},k.prototype.close=function(t,e){var o=this;if(t&&!n.userSetCode(t))throw new Error("INVALID_ACCESS_ERR");return o.readyState!==k.CONNECTING&&o.readyState!==k.OPEN?!1:(o.readyState=k.CLOSING,o._didClose(t||1e3,e||"Normal closure"),!0)},k.prototype.send=function(t){var e=this;if(e.readyState===k.CONNECTING)throw new Error("INVALID_STATE_ERR");return e.readyState===k.OPEN&&e._transport.doSend(n.quote(""+t)),!0},k.prototype._applyInfo=function(e,o,r){var i=this;i._options.info=e,i._options.rtt=o,i._options.rto=n.countRTO(o),i._options.info.null_origin=!t.domain;var s=n.probeProtocols();i._protocols=n.detectProtocols(s,r,e)};var S=k.websocket=function(t,o){var r=this,i=o+"/websocket";i="https"===i.slice(0,5)?"wss"+i.slice(5):"ws"+i.slice(4),r.ri=t,r.url=i;var s=e.WebSocket||e.MozWebSocket;r.ws=new s(r.url),r.ws.onmessage=function(t){r.ri._didMessage(t.data)},r.unload_ref=n.unload_add(function(){r.ws.close()}),r.ws.onclose=function(){r.ri._didMessage(n.closeFrame(1006,"WebSocket connection broken"))}};S.prototype.doSend=function(t){this.ws.send("["+t+"]")},S.prototype.doCleanup=function(){var t=this,e=t.ws;e&&(e.onmessage=e.onclose=null,e.close(),n.unload_del(t.unload_ref),t.unload_ref=t.ri=t.ws=null)},S.enabled=function(){return!(!e.WebSocket&&!e.MozWebSocket)},S.roundTrips=2;var C=function(){};C.prototype.send_constructor=function(t){var e=this;e.send_buffer=[],e.sender=t},C.prototype.doSend=function(t){var e=this;e.send_buffer.push(t),e.send_stop||e.send_schedule()},C.prototype.send_schedule_wait=function(){var t,e=this;e.send_stop=function(){e.send_stop=null,clearTimeout(t)},t=n.delay(25,function(){e.send_stop=null,e.send_schedule()})},C.prototype.send_schedule=function(){var t=this;if(t.send_buffer.length>0){var e="["+t.send_buffer.join(",")+"]";t.send_stop=t.sender(t.trans_url,e,function(e,n){t.send_stop=null,e===!1?t.ri._didClose(1006,"Sending error "+n):t.send_schedule_wait()}),t.send_buffer=[]}},C.prototype.send_destructor=function(){var t=this;t._send_stop&&t._send_stop(),t._send_stop=null};var O=function(e,o,r){var i=this;if(!("_send_form"in i)){var s=i._send_form=t.createElement("form"),a=i._send_area=t.createElement("textarea");a.name="d",s.style.display="none",s.style.position="absolute",s.method="POST",s.enctype="application/x-www-form-urlencoded",s.acceptCharset="UTF-8",s.appendChild(a),t.body.appendChild(s)}var s=i._send_form,a=i._send_area,c="a"+n.random_string(8);s.target=c,s.action=e+"/jsonp_send?i="+c;var l;try{l=t.createElement('<iframe name="'+c+'">')}catch(u){l=t.createElement("iframe"),l.name=c}l.id=c,s.appendChild(l),l.style.display="none";try{a.value=o}catch(p){n.log("Your browser is seriously broken. Go home! "+p.message)}s.submit();var d=function(t){l.onerror&&(l.onreadystatechange=l.onerror=l.onload=null,n.delay(500,function(){l.parentNode.removeChild(l),l=null}),a.value="",r(!0))};return l.onerror=l.onload=d,l.onreadystatechange=function(t){"complete"==l.readyState&&d()},d},N=function(t){return function(e,n,o){var r=new t("POST",e+"/xhr_send",n);return r.onfinish=function(t,e){o(200===t||204===t,"http status "+t)},function(t){o(!1,t)}}},T=function(e,o){var r,i,s=t.createElement("script"),a=function(t){i&&(i.parentNode.removeChild(i),i=null),s&&(clearTimeout(r),s.parentNode.removeChild(s),s.onreadystatechange=s.onerror=s.onload=s.onclick=null,s=null,o(t),o=null)},c=!1,l=null;if(s.id="a"+n.random_string(8),s.src=e,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(t){l||(l=setTimeout(function(){c||a(n.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},s.onload=function(t){a(n.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(t){if(/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick){c=!0;try{s.onclick()}catch(e){}}s&&a(n.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof s.async&&t.attachEvent)if(/opera/i.test(navigator.userAgent))i=t.createElement("script"),i.text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=i.async=!1;else{try{s.htmlFor=s.id,s.event="onclick"}catch(u){}s.async=!0}"undefined"!=typeof s.async&&(s.async=!0),r=setTimeout(function(){a(n.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var p=t.getElementsByTagName("head")[0];return p.insertBefore(s,p.firstChild),i&&p.insertBefore(i,p.firstChild),a},M=k["jsonp-polling"]=function(t,e){n.polluteGlobalNamespace();var o=this;o.ri=t,o.trans_url=e,o.send_constructor(O),o._schedule_recv()};M.prototype=new C,M.prototype._schedule_recv=function(){var t=this,e=function(e){t._recv_stop=null,e&&(t._is_closing||t.ri._didMessage(e)),t._is_closing||t._schedule_recv()};t._recv_stop=L(t.trans_url+"/jsonp",T,e)},M.enabled=function(){return!0},M.need_body=!0,M.prototype.doCleanup=function(){var t=this;t._is_closing=!0,t._recv_stop&&t._recv_stop(),t.ri=t._recv_stop=null,t.send_destructor()};var L=function(t,o,r){var i="a"+n.random_string(6),s=t+"?c="+escape(a+"."+i),c=0,l=function(t){switch(c){case 0:delete e[a][i],r(t);break;case 1:r(t),c=2;break;case 2:delete e[a][i]}},u=o(s,l);e[a][i]=u;var p=function(){e[a][i]&&(c=1,e[a][i](n.closeFrame(1e3,"JSONP user aborted read")))};return p},I=function(){};I.prototype=new C,I.prototype.run=function(t,e,n,o,r){var i=this;i.ri=t,i.trans_url=e,i.send_constructor(N(r)),i.poll=new Z(t,o,e+n,r)},I.prototype.doCleanup=function(){var t=this;t.poll&&(t.poll.abort(),t.poll=null)};var D=k["xhr-streaming"]=function(t,e){this.run(t,e,"/xhr_streaming",ot,n.XHRCorsObject)};D.prototype=new I,D.enabled=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},D.roundTrips=2,D.need_body=!0;var j=k["xdr-streaming"]=function(t,e){this.run(t,e,"/xhr_streaming",ot,n.XDRObject)};j.prototype=new I,j.enabled=function(){return!!e.XDomainRequest},j.roundTrips=2;var R=k["xhr-polling"]=function(t,e){this.run(t,e,"/xhr",ot,n.XHRCorsObject)};R.prototype=new I,R.enabled=D.enabled,R.roundTrips=2;var A=k["xdr-polling"]=function(t,e){this.run(t,e,"/xhr",ot,n.XDRObject)};A.prototype=new I,A.enabled=j.enabled,A.roundTrips=2;var H=function(){};H.prototype.i_constructor=function(t,e,o){var r=this;r.ri=t,r.origin=n.getOrigin(o),r.base_url=o,r.trans_url=e;var i=o+"/iframe.html";r.ri._options.devel&&(i+="?t="+ +new Date),r.window_id=n.random_string(8),i+="#"+r.window_id,r.iframeObj=n.createIframe(i,function(t){r.ri._didClose(1006,"Unable to load an iframe ("+t+")")}),r.onmessage_cb=n.bind(r.onmessage,r),n.attachMessage(r.onmessage_cb)},H.prototype.doCleanup=function(){var t=this;if(t.iframeObj){n.detachMessage(t.onmessage_cb);try{t.iframeObj.iframe.contentWindow&&t.postMessage("c")}catch(e){}t.iframeObj.cleanup(),t.iframeObj=null,t.onmessage_cb=t.iframeObj=null}},H.prototype.onmessage=function(t){var e=this;if(t.origin===e.origin){var n=t.data.slice(0,8),o=t.data.slice(8,9),r=t.data.slice(9);if(n===e.window_id)switch(o){case"s":e.iframeObj.loaded(),e.postMessage("s",JSON.stringify([k.version,e.protocol,e.trans_url,e.base_url]));break;case"t":e.ri._didMessage(r)}}},H.prototype.postMessage=function(t,e){var n=this;n.iframeObj.post(n.window_id+t+(e||""),n.origin)},H.prototype.doSend=function(t){this.postMessage("m",t)},H.enabled=function(){var t=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof e.postMessage||"object"==typeof e.postMessage)&&!t};var P,F=function(t,o){parent!==e?parent.postMessage(P+t+(o||""),"*"):n.log("Can't postMessage, no parent window.",t,o)},X=function(){};X.prototype._didClose=function(t,e){F("t",n.closeFrame(t,e))},X.prototype._didMessage=function(t){F("t",t)},X.prototype._doSend=function(t){this._transport.doSend(t)},X.prototype._doCleanup=function(){this._transport.doCleanup()},n.parent_origin=void 0,k.bootstrap_iframe=function(){var o;P=t.location.hash.slice(1);var r=function(t){if(t.source===parent&&("undefined"==typeof n.parent_origin&&(n.parent_origin=t.origin),t.origin===n.parent_origin)){var r=t.data.slice(0,8),i=t.data.slice(8,9),s=t.data.slice(9);if(r===P)switch(i){case"s":var a=JSON.parse(s),c=a[0],l=a[1],u=a[2],p=a[3];if(c!==k.version&&n.log('Incompatibile SockJS! Main site uses: "'+c+'", the iframe: "'+k.version+'".'),!n.flatUrl(u)||!n.flatUrl(p))return void n.log("Only basic urls are supported in SockJS");if(!n.isSameOriginUrl(u)||!n.isSameOriginUrl(p))return void n.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([e.location.href,u,p])+")");o=new X,o._transport=new X[l](o,u,p);break;case"m":o._doSend(s);break;case"c":o&&o._doCleanup(),o=null}}};n.attachMessage(r),F("s")};var J=function(t,e){var o=this;n.delay(function(){o.doXhr(t,e)})};J.prototype=new i(["finish"]),J.prototype.doXhr=function(t,e){var o=this,r=(new Date).getTime(),i=new e("GET",t+"/info"),s=n.delay(8e3,function(){i.ontimeout()});i.onfinish=function(t,e){if(clearTimeout(s),s=null,200===t){var n=(new Date).getTime()-r,i=JSON.parse(e);"object"!=typeof i&&(i={}),o.emit("finish",i,n)}else o.emit("finish")},i.ontimeout=function(){i.close(),o.emit("finish")}};var q=function(e){var o=this,r=function(){var t=new H;t.protocol="w-iframe-info-receiver";var n=function(e){if("string"==typeof e&&"m"===e.substr(0,1)){var n=JSON.parse(e.substr(1)),r=n[0],i=n[1];o.emit("finish",r,i)}else o.emit("finish");t.doCleanup(),t=null},r={_options:{},_didClose:n,_didMessage:n};t.i_constructor(r,e,e)};t.body?r():n.attachEvent("load",r)};q.prototype=new i(["finish"]);var U=function(){var t=this;n.delay(function(){t.emit("finish",{},2e3)})};U.prototype=new i(["finish"]);var W=function(t){if(n.isSameOriginUrl(t))return new J(t,n.XHRLocalObject);switch(n.isXHRCorsCapable()){case 1:return new J(t,n.XHRLocalObject);case 2:return new J(t,n.XDRObject);case 3:return new q(t);default:return new U}},z=X["w-iframe-info-receiver"]=function(t,e,o){var r=new J(o,n.XHRLocalObject);r.onfinish=function(e,n){t._didMessage("m"+JSON.stringify([e,n])),t._didClose()}};z.prototype.doCleanup=function(){};var G=k["iframe-eventsource"]=function(){var t=this;t.protocol="w-iframe-eventsource",t.i_constructor.apply(t,arguments)};G.prototype=new H,G.enabled=function(){return"EventSource"in e&&H.enabled()},G.need_body=!0,G.roundTrips=3;var Y=X["w-iframe-eventsource"]=function(t,e){this.run(t,e,"/eventsource",Q,n.XHRLocalObject)};Y.prototype=new I;var B=k["iframe-xhr-polling"]=function(){var t=this;t.protocol="w-iframe-xhr-polling",t.i_constructor.apply(t,arguments)};B.prototype=new H,B.enabled=function(){return e.XMLHttpRequest&&H.enabled()},B.need_body=!0,B.roundTrips=3;var $=X["w-iframe-xhr-polling"]=function(t,e){this.run(t,e,"/xhr",ot,n.XHRLocalObject)};$.prototype=new I;var K=k["iframe-htmlfile"]=function(){var t=this;t.protocol="w-iframe-htmlfile",t.i_constructor.apply(t,arguments)};K.prototype=new H,K.enabled=function(){return H.enabled()},K.need_body=!0,K.roundTrips=3;var V=X["w-iframe-htmlfile"]=function(t,e){this.run(t,e,"/htmlfile",nt,n.XHRLocalObject)};V.prototype=new I;var Z=function(t,e,n,o){var r=this;r.ri=t,r.Receiver=e,r.recv_url=n,r.AjaxObject=o,r._scheduleRecv()};Z.prototype._scheduleRecv=function(){var t=this,e=t.poll=new t.Receiver(t.recv_url,t.AjaxObject),n=0;e.onmessage=function(e){n+=1,t.ri._didMessage(e.data)},e.onclose=function(n){t.poll=e=e.onmessage=e.onclose=null,t.poll_is_closing||("permanent"===n.reason?t.ri._didClose(1006,"Polling error ("+n.reason+")"):t._scheduleRecv())}},Z.prototype.abort=function(){var t=this;t.poll_is_closing=!0,t.poll&&t.poll.abort()};var Q=function(t){var e=this,o=new EventSource(t);o.onmessage=function(t){e.dispatchEvent(new r("message",{data:unescape(t.data)}))},e.es_close=o.onerror=function(t,i){var s=i?"user":2!==o.readyState?"network":"permanent";e.es_close=o.onmessage=o.onerror=null,o.close(),o=null,n.delay(200,function(){e.dispatchEvent(new r("close",{reason:s}))})}};Q.prototype=new o,Q.prototype.abort=function(){var t=this;t.es_close&&t.es_close({},!0)};var tt,et=function(){if(void 0===tt)if("ActiveXObject"in e)try{tt=!!new ActiveXObject("htmlfile")}catch(t){}else tt=!1;return tt},nt=function(t){var o=this;n.polluteGlobalNamespace(),o.id="a"+n.random_string(6,26),t+=(-1===t.indexOf("?")?"?":"&")+"c="+escape(a+"."+o.id);var i,s=et()?n.createHtmlfile:n.createIframe;e[a][o.id]={start:function(){i.loaded()},message:function(t){o.dispatchEvent(new r("message",{data:t}))},stop:function(){o.iframe_close({},"network")}},o.iframe_close=function(t,n){i.cleanup(),o.iframe_close=i=null,delete e[a][o.id],o.dispatchEvent(new r("close",{reason:n}))},i=s(t,function(t){o.iframe_close({},"permanent")})};nt.prototype=new o,nt.prototype.abort=function(){var t=this;t.iframe_close&&t.iframe_close({},"user")};var ot=function(t,e){var n=this,o=0;n.xo=new e("POST",t,null),n.xo.onchunk=function(t,e){if(200===t)for(;;){var i=e.slice(o),s=i.indexOf("\n");if(-1===s)break;o+=s+1;var a=i.slice(0,s);n.dispatchEvent(new r("message",{data:a}))}},n.xo.onfinish=function(t,e){n.xo.onchunk(t,e),n.xo=null;var o=200===t?"network":"permanent";n.dispatchEvent(new r("close",{reason:o}))}};return ot.prototype=new o,ot.prototype.abort=function(){var t=this;t.xo&&(t.xo.close(),t.dispatchEvent(new r("close",{reason:"user"})),t.xo=null)},k.getUtils=function(){return n},k.getIframeTransport=function(){return H},k}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),module.exports=SockJS},{}]},{},[5]);